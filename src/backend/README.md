# Driver Drowsiness Detection Backend API

Flask-based REST API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏Ç‡∏ì‡∏∞‡∏Ç‡∏±‡∏ö‡∏Ç‡∏µ‡πà ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ML models ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß (YOLO, Faster R-CNN, VGG16) ‡∏û‡∏£‡πâ‡∏≠‡∏° Mock Data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

## üöÄ Quick Start

### Prerequisites

- Python 3.8+
- pip

### Installation & Setup

```bash
# 1. Create virtual environment
python3 -m venv .venv
source .venv/bin/activate  # macOS/Linux
# ‡∏´‡∏£‡∏∑‡∏≠ .venv\Scripts\activate  # Windows

# 2. Install dependencies
pip install Flask Flask-CORS Pillow python-dotenv

# 3. Run development server
python app_mock.py
```

Server ‡∏à‡∏∞‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πà: **http://localhost:8000**

---

## üìã API Endpoints Documentation

### Base URL: `http://localhost:8000`

---

### 1. üè• Health Check

```http
GET /api/health
```

**Description:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á backend server ‡πÅ‡∏•‡∏∞ ML models

**Response:**

```json
{
  "status": "healthy",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "modelsLoaded": ["yolo", "faster_rcnn", "vgg16"],
  "server": "Flask Development Server",
  "mode": "mock_data",
  "version": "1.0.0"
}
```

---

### 2. ü§ñ Get Available Models

```http
GET /api/models
```

**Description:** ‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ML models ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

**Response:**

```json
{
  "status": "success",
  "totalModels": 3,
  "timestamp": "2025-09-24T10:30:00.000Z",
  "models": [
    {
      "name": "yolo",
      "displayName": "YOLOv8 Object Detection",
      "description": "Fast real-time object detection optimized for mobile devices",
      "accuracy": 0.87,
      "speed": "fast",
      "memoryUsage": "medium",
      "isAvailable": true
    },
    {
      "name": "faster_rcnn",
      "displayName": "Faster R-CNN",
      "description": "High accuracy object detection with region proposals",
      "accuracy": 0.91,
      "speed": "slow",
      "memoryUsage": "high",
      "isAvailable": true
    },
    {
      "name": "vgg16",
      "displayName": "VGG16 Classifier",
      "description": "Deep CNN for binary drowsiness classification",
      "accuracy": 0.83,
      "speed": "medium",
      "memoryUsage": "low",
      "isAvailable": true
    }
  ]
}
```

---

### 3. üîç Single Image Detection

```http
POST /api/detect
```

**Description:** ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß

**Request Headers:**

```
Content-Type: application/json
```

**Request Body:**

```json
{
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ...",
  "model": "yolo", // optional: "yolo" | "faster_rcnn" | "vgg16"
  "sessionId": "session_123" // optional
}
```

**Response (Alert):**

```json
{
  "id": "yolo_1727172600000",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "isDrowsy": false,
  "confidence": 0.234,
  "modelUsed": "yolo",
  "inferenceTime": 0.342,
  "alertTriggered": false,
  "sessionId": "session_123",
  "status": "success",
  "bbox": {
    "x": 120,
    "y": 80,
    "width": 150,
    "height": 200
  }
}
```

**Response (Drowsy Detected):**

```json
{
  "id": "yolo_1727172600000",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "isDrowsy": true,
  "confidence": 0.876,
  "modelUsed": "yolo",
  "inferenceTime": 0.234,
  "alertTriggered": true,
  "sessionId": "session_123",
  "status": "success",
  "bbox": {
    "x": 100,
    "y": 100,
    "width": 200,
    "height": 200
  }
}
```

---

### 4. üìä Batch Image Detection

```http
POST /api/detect/batch
```

**Description:** ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏π‡∏õ)

**Request Body:**

```json
{
  "images": [
    "data:image/jpeg;base64,/9j/4AAQ...",
    "data:image/jpeg;base64,/9j/4AAQ...",
    "data:image/jpeg;base64,/9j/4AAQ..."
  ],
  "model": "faster_rcnn", // optional
  "sessionId": "batch_session_456" // optional
}
```

**Response:**

```json
{
  "status": "success",
  "results": [
    {
      "index": 0,
      "id": "faster_rcnn_1727172600001",
      "timestamp": "2025-09-24T10:30:00.000Z",
      "isDrowsy": true,
      "confidence": 0.912,
      "modelUsed": "faster_rcnn",
      "inferenceTime": 0,
      "alertTriggered": true,
      "sessionId": "batch_session_456",
      "status": "success",
      "bbox": {
        "x": 95,
        "y": 110,
        "width": 180,
        "height": 220
      }
    },
    {
      "index": 1,
      "id": "faster_rcnn_1727172600002",
      "timestamp": "2025-09-24T10:30:00.000Z",
      "isDrowsy": false,
      "confidence": 0.156,
      "modelUsed": "faster_rcnn",
      "inferenceTime": 0,
      "alertTriggered": false,
      "sessionId": "batch_session_456",
      "status": "success"
    }
  ],
  "summary": {
    "totalDetections": 2,
    "drowsyDetections": 1,
    "alertRate": 0.5,
    "averageConfidence": 0.534
  },
  "totalInferenceTime": 1.234,
  "modelUsed": "faster_rcnn",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "sessionId": "batch_session_456"
}
```

---

### 5. ‚ñ∂Ô∏è Start Detection Session

```http
POST /api/session/start
```

**Description:** ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô detection session ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

**Request Body:**

```json
{
  "settings": {
    "model": "yolo",
    "confidenceThreshold": 0.7,
    "frameInterval": 500,
    "autoStart": true,
    "enablePreprocessing": true
  }
}
```

**Response:**

```json
{
  "status": "success",
  "sessionId": "session_1727172600",
  "action": "started",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "message": "Detection session started successfully",
  "sessionData": {
    "startTime": "2025-09-24T10:30:00.000Z",
    "settings": {
      "model": "yolo",
      "confidenceThreshold": 0.7,
      "frameInterval": 500,
      "autoStart": true,
      "enablePreprocessing": true
    }
  }
}
```

---

### 6. ‚èπÔ∏è End Detection Session

```http
POST /api/session/end
```

**Description:** ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î detection session ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•

**Request Body:**

```json
{
  "sessionId": "session_1727172600"
}
```

**Response:**

```json
{
  "status": "success",
  "sessionId": "session_1727172600",
  "action": "ended",
  "timestamp": "2025-09-24T11:30:00.000Z",
  "message": "Detection session ended successfully",
  "sessionData": {
    "endTime": "2025-09-24T11:30:00.000Z",
    "summary": {
      "duration": 3600,
      "totalFrames": 150,
      "drowsyFrames": 12,
      "alertsTriggered": 3
    }
  }
}
```

---

### 7. üìà Get Session History

```http
GET /api/session/history
```

**Description:** ‡∏Ç‡∏≠‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ detection sessions ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤

**Response:**

```json
{
  "status": "success",
  "totalSessions": 5,
  "totalDrowsyDetections": 47,
  "timestamp": "2025-09-24T10:30:00.000Z",
  "sessions": [
    {
      "id": "session_1727169000",
      "startTime": "2025-09-24T09:30:00.000Z",
      "endTime": "2025-09-24T10:30:00.000Z",
      "duration": 3600,
      "totalFrames": 120,
      "drowsyFrames": 7,
      "alertsTriggered": 2,
      "averageConfidence": 0.75,
      "modelUsed": "yolo",
      "isActive": false,
      "settings": {
        "model": "yolo",
        "confidenceThreshold": 0.5,
        "frameInterval": 500,
        "autoStart": true,
        "enablePreprocessing": true
      }
    }
  ]
}
```

---

## ‚ùå Error Responses

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î API ‡∏à‡∏∞‡∏™‡πà‡∏á HTTP status code ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° error response:

```json
{
  "status": "error",
  "message": "Description of the error",
  "timestamp": "2025-09-24T10:30:00.000Z",
  "errorCode": "ERROR_CODE_NAME",
  "details": {
    "field": "fieldName",
    "validationMessage": "Specific validation error",
    "receivedValue": "invalid_value"
  }
}
```

### Common Error Codes:

- **400 Bad Request**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- **404 Not Found**: ‡πÑ‡∏°‡πà‡∏û‡∏ö endpoint ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
- **500 Internal Server Error**: ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

---

## üìä Response Fields Reference

| Field            | Type    | Description                                            |
| ---------------- | ------- | ------------------------------------------------------ |
| `isDrowsy`       | boolean | `true` = ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô, `false` = ‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô          |
| `confidence`     | float   | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á model (0.0-1.0)                          |
| `bbox`           | object  | ‡∏û‡∏¥‡∏Å‡∏±‡∏î bounding box `{x, y, width, height}`             |
| `alertTriggered` | boolean | `true` ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `isDrowsy=true` ‡πÅ‡∏•‡∏∞ `confidence>0.7`      |
| `inferenceTime`  | float   | ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)                                  |
| `modelUsed`      | string  | Model ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: `"yolo"` \| `"faster_rcnn"` \| `"vgg16"` |
| `sessionId`      | string  | ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏∞‡∏ö‡∏∏ session (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)                               |

---

## üîß Development Features

### Mock Data Mode

Backend ‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Mock Data ‡∏ó‡∏µ‡πà:

- ‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ML models ‡∏à‡∏£‡∏¥‡∏á
- ‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (30% chance of drowsiness)
- ‚úÖ ‡∏à‡∏≥‡∏•‡∏≠‡∏á inference time ‡πÅ‡∏•‡∏∞ network delay
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å API endpoints

### Model Performance Simulation

| Model        | Speed  | Accuracy | Memory Usage | Inference Time |
| ------------ | ------ | -------- | ------------ | -------------- |
| YOLO         | Fast   | 87%      | Medium       | 0.1-0.3s       |
| Faster R-CNN | Slow   | 91%      | High         | 0.5-1.2s       |
| VGG16        | Medium | 83%      | Low          | 0.2-0.6s       |

---

## üìÅ Project Structure

```
backend/
‚îú‚îÄ‚îÄ app_mock.py              # Main Flask application (Mock version)
‚îú‚îÄ‚îÄ app.py                   # Production Flask app (with real ML models)
‚îú‚îÄ‚îÄ requirements.txt         # Full dependencies with ML libraries
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ real_model_loader.py # Real YOLO model loader/inference
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ image_processing.py # Image preprocessing utilities
‚îÇ   ‚îî‚îÄ‚îÄ response_formatter.py # API response formatter
‚îî‚îÄ‚îÄ .venv/                  # Virtual environment
```

---

## üß™ Testing

### Manual Testing with cURL

**Health Check:**

```bash
curl http://localhost:8000/api/health
```

**Get Models:**

```bash
curl http://localhost:8000/api/models
```

**Single Detection:**

```bash
curl -X POST http://localhost:8000/api/detect \
  -H "Content-Type: application/json" \
  -d '{
    "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ...",
    "model": "yolo",
    "sessionId": "test_123"
  }'
```

### Frontend Integration

API ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö Ionic React frontend ‡∏ó‡∏µ‡πà:

- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö CORS
- ‚úÖ ‡πÉ‡∏ä‡πâ JSON format
- ‚úÖ ‡∏°‡∏µ error handling ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö base64 image uploads

---

## üöÄ Production Deployment

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production ‡πÉ‡∏´‡πâ:

1. **‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ML dependencies:**

```bash
pip install -r requirements.txt
```

2. **‡πÉ‡∏ä‡πâ production WSGI server:**

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app
```

3. **‡∏Å‡∏≥‡∏´‡∏ô‡∏î environment variables:**

```bash
export API_HOST=0.0.0.0
export API_PORT=8000
export DEBUG=False
```

---

## üìù API Design Principles

- **RESTful**: ‡πÉ‡∏ä‡πâ HTTP methods ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
- **Consistent**: Response format ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å endpoint
- **Error-friendly**: Error messages ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
- **Mobile-optimized**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö base64 image uploads
- **Scalable**: Session management ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö tracking

---

## ü§ù Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/new-feature`
3. Commit changes: `git commit -m 'Add new feature'`
4. Push to branch: `git push origin feature/new-feature`
5. Submit pull request

---

## üìÑ License

This project is part of Driver Drowsiness Detection System.
